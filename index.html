<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Palettes Roses - Boutique</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="banniere">
  <h1>Mini Palettes Roses</h1>
  <p>VÃªtements personnalisÃ©s en rose et blanc</p>
</header>

<button id="btn-panier" title="Voir le panier">ğŸ›’ Panier (<span id="nb-items">0</span>)</button>

<div id="sidebar-panier" class="sidebar-closed">
  <button id="btn-fermer-panier">âœ–</button>
  <h2>Ton panier</h2>
  <ul id="liste-panier"></ul>
  <p><strong>Total : <span id="total">0.00</span> $</strong></p>
  <button id="payer">ProcÃ©der au paiement</button>
</div>

<main>
  <section id="galerie-produits" class="galerie"></section>
</main>

<script>
  // Panier en mÃ©moire
  let panier = JSON.parse(localStorage.getItem('panier')) || [];

  // Met Ã  jour compteur panier
  function majNbItems() {
    document.getElementById('nb-items').textContent = panier.length;
  }

  // Affiche le panier dans la sidebar
  function afficherPanier() {
    const liste = document.getElementById('liste-panier');
    liste.innerHTML = '';
    let total = 0;
    panier.forEach(item => {
      total += item.prix;
      const li = document.createElement('li');
      li.textContent = `${item.nom} - ${item.prix.toFixed(2)} $`;
      liste.appendChild(li);
    });
    document.getElementById('total').textContent = total.toFixed(2);
    majNbItems();
  }

  // Ajoute au panier et sauvegarde localStorage
  function ajouterAuPanier(nom, prix) {
    panier.push({ nom, prix });
    localStorage.setItem('panier', JSON.stringify(panier));
    afficherPanier();
    alert(`AjoutÃ© au panier : ${nom} pour ${prix.toFixed(2)} $`);
  }

  // Gestion sidebar panier
  const btnPanier = document.getElementById('btn-panier');
  const sidebarPanier = document.getElementById('sidebar-panier');
  const btnFermerPanier = document.getElementById('btn-fermer-panier');

  btnPanier.addEventListener('click', () => {
    sidebarPanier.classList.toggle('open');
  });
  btnFermerPanier.addEventListener('click', () => {
    sidebarPanier.classList.remove('open');
  });

  // Chargement produits depuis 'produits.html'
  fetch('produits.html')
    .then(res => res.text())
    .then(html => {
      const container = document.getElementById('galerie-produits');
      container.innerHTML = html;

      // Pour chaque produit, on ajoute lien vers produit.html avec id + bouton ajouter
      document.querySelectorAll('.produit').forEach(produit => {
        const nom = produit.dataset.nom;
        const prix = parseFloat(produit.dataset.prix);

        // CrÃ©er un lien vers produit.html?id=nom-formatÃ© (ex: tshirt-rose)
        const idProduit = nom.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
        const lien = document.createElement('a');
        lien.href = `produit.html?id=${idProduit}`;
        lien.className = 'lien-produit';

        // RÃ©cupÃ©rer image, titre, prix pour les mettre dans le lien
        const img = produit.querySelector('img');
        const h3 = produit.querySelector('h3');
        const pPrix = produit.querySelector('p');

        lien.appendChild(img.cloneNode(true));
        lien.appendChild(h3.cloneNode(true));
        lien.appendChild(pPrix.cloneNode(true));

        // Nettoyer le produit, ajouter lien + bouton
        produit.innerHTML = '';
        produit.appendChild(lien);

        const btnAjouter = document.createElement('button');
        btnAjouter.className = 'btn-ajouter';
        btnAjouter.textContent = 'Ajouter au panier';
        btnAjouter.addEventListener('click', () => ajouterAuPanier(nom, prix));
        produit.appendChild(btnAjouter);
      });
    });

  // Initialiser lâ€™affichage du panier
  afficherPanier();

  // Pour le bouton payer (sans intÃ©gration Stripe ici)
  document.getElementById('payer').addEventListener('click', () => {
    alert('Paiement non encore intÃ©grÃ©.');
  });
</script>

</body>
</html>
